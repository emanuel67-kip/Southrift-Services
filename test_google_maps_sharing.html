<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Google Maps Link Sharing - SouthRift Services</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .btn {
            background: #6A0DAD;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        .btn:hover {
            background: #4e0b8a;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        .instructions {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .instructions ol {
            margin: 10px 0;
        }
        .instructions li {
            margin: 8px 0;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            body {
                padding: 18px;
            }
            
            .card {
                padding: 18px;
            }
            
            .btn {
                padding: 11px 22px;
            }
        }
        
        @media (max-width: 992px) {
            body {
                padding: 15px;
            }
            
            .card {
                padding: 16px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.95rem;
            }
            
            input[type="text"] {
                padding: 10px;
                font-size: 13px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .btn {
                padding: 9px 18px;
                font-size: 0.9rem;
                width: 100%;
                margin: 5px 0;
            }
            
            input[type="text"] {
                padding: 9px;
                font-size: 12px;
            }
            
            h1 {
                font-size: 1.4rem;
            }
            
            h3 {
                font-size: 1.1rem;
            }
            
            .instructions ol {
                padding-left: 15px;
            }
        }
        
        @media (max-width: 576px) {
            body {
                padding: 10px;
            }
            
            .card {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 0.85rem;
            }
            
            input[type="text"] {
                padding: 8px;
                font-size: 11px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            h3 {
                font-size: 1rem;
            }
            
            .instructions {
                padding: 12px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .card {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .btn {
                padding: 7px 12px;
                font-size: 0.8rem;
            }
            
            input[type="text"] {
                padding: 7px;
                font-size: 10px;
            }
            
            h1 {
                font-size: 1.2rem;
            }
            
            h3 {
                font-size: 0.95rem;
            }
            
            .success, .error {
                padding: 8px;
                font-size: 0.85rem;
            }
        }
        
        @media (max-width: 360px) {
            body {
                padding: 6px;
            }
            
            .card {
                padding: 8px;
                margin-bottom: 8px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            
            input[type="text"] {
                padding: 6px;
                font-size: 9px;
            }
            
            h1 {
                font-size: 1.1rem;
            }
            
            h3 {
                font-size: 0.9rem;
            }
            
            .instructions {
                padding: 10px;
            }
            
            .instructions li {
                margin: 5px 0;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üó∫Ô∏è Test Google Maps Link Sharing</h1>
        <p>This page allows you to test the Google Maps link sharing functionality.</p>
    </div>

    <div class="card instructions">
        <h3>üìã How to get a Google Maps share link:</h3>
        <ol>
            <li><strong>Open Google Maps</strong> on your phone</li>
            <li><strong>Tap the blue dot</strong> (your current location)</li>
            <li><strong>Tap "Share your location"</strong></li>
            <li><strong>Choose duration</strong> (e.g., "1 hour")</li>
            <li><strong>Tap "Copy to clipboard"</strong> or share via message</li>
            <li><strong>Paste the link</strong> in the field below</li>
        </ol>
        <p><strong>Example link format:</strong> <code>https://maps.app.goo.gl/ABC123...</code></p>
    </div>

    <div class="card">
        <h3>üöó Share Your Location</h3>
        <form id="shareForm">
            <label for="driverPhone"><strong>Driver Phone:</strong></label>
            <select id="driverPhone" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; margin: 10px 0; font-size: 14px;">
                <option value="0798365350">0798365350 (Kibet Bett)</option>
                <option value="0736225373">0736225373 (Driver1)</option>
            </select>
            
            <label for="googleMapsLink"><strong>Google Maps Link:</strong></label>
            <input type="text" id="googleMapsLink" placeholder="https://maps.app.goo.gl/...">
            
            <button type="submit" class="btn">üìç Share with Passengers</button>
        </form>
        
        <div id="result"></div>
    </div>

    <div class="card">
        <h3>üß™ Test Actions</h3>
        <button onclick="checkStatus()" class="btn">üìä Check Sharing Status</button>
        <button onclick="stopSharing()" class="btn" style="background: #dc3545;">üõë Stop Sharing</button>
        <a href="../track_my_driver.php?booking_id=1" class="btn" target="_blank">üëÅÔ∏è View Passenger Tracking Page</a>
    </div>

    <div class="card">
        <h3>üìù Test Results</h3>
        <div id="testResults"></div>
    </div>

    <script>
        // Sample Google Maps links for testing
        const sampleLinks = [
            'https://maps.app.goo.gl/ABC123XYZ789',
            'https://www.google.com/maps/place/@-1.286389,36.817223,15z',
            'https://maps.google.com/maps?q=-1.286389,36.817223'
        ];

        // Auto-fill with sample link for quick testing
        document.getElementById('googleMapsLink').value = sampleLinks[0];

        document.getElementById('shareForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const driverPhone = document.getElementById('driverPhone').value;
            const googleMapsLink = document.getElementById('googleMapsLink').value;
            const resultDiv = document.getElementById('result');
            
            if (!driverPhone || !googleMapsLink) {
                resultDiv.innerHTML = '<div class="error">Please fill in all fields</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div>Sharing location...</div>';
            
            try {
                const response = await fetch('../Driver/share_google_maps_link.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `csrf_token=test&driver_phone=${encodeURIComponent(driverPhone)}&google_maps_link=${encodeURIComponent(googleMapsLink)}`
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Location shared successfully!<br>
                            üì± Passengers notified: ${data.passengers_notified}<br>
                            üîó Link: ${data.google_maps_link.substring(0, 50)}...
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Network error: ${error.message}</div>`;
            }
        });
        
        async function checkStatus() {
            const driverPhone = document.getElementById('driverPhone').value;
            const resultDiv = document.getElementById('testResults');
            
            if (!driverPhone) {
                resultDiv.innerHTML = '<div class="error">Please enter driver phone number</div>';
                return;
            }
            
            try {
                const response = await fetch('../Driver/check_google_maps_sharing.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `csrf_token=test&driver_phone=${encodeURIComponent(driverPhone)}`
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="${data.is_sharing ? 'success' : 'error'}">
                            üìä <strong>Sharing Status:</strong> ${data.is_sharing ? '‚úÖ Active' : '‚ùå Not sharing'}<br>
                            ${data.google_maps_link ? `üîó <strong>Link:</strong> ${data.google_maps_link.substring(0, 50)}...<br>` : ''}
                            üë• <strong>Passengers:</strong> ${data.passengers_count}<br>
                            üïí <strong>Last Updated:</strong> ${data.last_updated || 'N/A'}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Network error: ${error.message}</div>`;
            }
        }
        
        async function stopSharing() {
            const driverPhone = document.getElementById('driverPhone').value;
            const resultDiv = document.getElementById('testResults');
            
            if (!driverPhone) {
                resultDiv.innerHTML = '<div class="error">Please enter driver phone number</div>';
                return;
            }
            
            try {
                const response = await fetch('../Driver/stop_google_maps_sharing.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `csrf_token=test&driver_phone=${encodeURIComponent(driverPhone)}`
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            üõë Location sharing stopped!<br>
                            üì± Passengers notified: ${data.passengers_notified}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Network error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>