<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Google Maps API Test - SouthRift</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        #map { 
            width: 100%; 
            height: 400px; 
            border: 1px solid #ccc; 
            margin: 20px 0; 
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb; 
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .btn-primary { 
            background: #6A0DAD; 
            color: white; 
        }
        .btn-primary:hover { 
            background: #4e0b8a; 
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .container {
                padding: 0 15px;
            }
            
            #map {
                height: 350px;
            }
        }
        
        @media (max-width: 992px) {
            body {
                margin: 15px;
            }
            
            .container {
                padding: 0 12px;
            }
            
            #map {
                height: 300px;
            }
            
            button {
                padding: 8px 16px;
                margin: 4px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 768px) {
            body {
                margin: 10px;
            }
            
            .container {
                padding: 0 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            #map {
                height: 250px;
            }
            
            button {
                padding: 8px 12px;
                margin: 3px;
                font-size: 0.85rem;
                width: 100%;
                margin-bottom: 8px;
            }
        }
        
        @media (max-width: 576px) {
            body {
                margin: 8px;
            }
            
            .container {
                padding: 0 8px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            #map {
                height: 200px;
            }
            
            .status {
                padding: 8px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            body {
                margin: 6px;
            }
            
            .container {
                padding: 0 6px;
            }
            
            h1 {
                font-size: 1.2rem;
            }
            
            #map {
                height: 180px;
            }
            
            button {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }
        
        @media (max-width: 360px) {
            body {
                margin: 5px;
            }
            
            h1 {
                font-size: 1.1rem;
            }
            
            #map {
                height: 160px;
            }
            
            .status {
                padding: 6px;
                font-size: 0.85rem;
            }
            
            button {
                padding: 5px 8px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Maps API Test</h1>
        <p>This page tests if the Google Maps API is properly configured.</p>
        
        <div id="status" class="status info">
            Loading Google Maps API...
        </div>
        
        <div id="map"></div>
        
        <div>
            <button class="btn-primary" onclick="testGeolocation()">Test Geolocation</button>
            <button class="btn-primary" onclick="testMarker()">Test Marker</button>
            <button class="btn-primary" onclick="window.location.reload()">Reload Test</button>
        </div>
        
        <div id="testResults"></div>
    </div>

    <script>
        let map, marker;
        let testResults = [];
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }
        
        function addTestResult(test, result, details = '') {
            testResults.push({ test, result, details, timestamp: new Date() });
            updateTestDisplay();
        }
        
        function updateTestDisplay() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h3>Test Results:</h3>';
            
            testResults.forEach(test => {
                const statusClass = test.result ? 'success' : 'error';
                const statusText = test.result ? '‚úÖ PASS' : '‚ùå FAIL';
                html += `
                    <div class="status ${statusClass}">
                        <strong>${test.test}</strong>: ${statusText}
                        <br><small>${test.details}</small>
                        <br><small>Time: ${test.timestamp.toLocaleTimeString()}</small>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        // Load Google Maps API
        function loadGoogleMaps() {
            const script = document.createElement('script');
            let apiKey = 'AIzaSyBFw0Qbyq9zTFTd-tUY6dpoWCjVOlY5g9U'; // Demo key
            
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&loading=async&callback=initMap`;
            script.async = true;
            script.defer = true;
            
            script.onerror = function() {
                updateStatus('‚ùå Failed to load Google Maps API script', 'error');
                addTestResult('API Script Loading', false, 'Script failed to load - check API key and internet connection');
            };
            
            document.head.appendChild(script);
            updateStatus('üì° Loading Google Maps API...', 'info');
        }
        
        function initMap() {
            try {
                updateStatus('‚úÖ Google Maps API loaded successfully!', 'success');
                addTestResult('API Loading', true, `Google Maps version: ${google.maps.version || 'unknown'}`);
                
                // Test basic map creation
                const defaultLocation = { lat: -1.286389, lng: 36.817223 }; // Nairobi
                
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 10,
                    center: defaultLocation,
                    mapTypeControl: true,
                    streetViewControl: true,
                    fullscreenControl: true
                });
                
                addTestResult('Map Creation', true, 'Basic map created successfully');
                
                // Test marker creation with fallback
                testMarkerCreation(defaultLocation);
                
            } catch (error) {
                updateStatus('‚ùå Error initializing Google Maps', 'error');
                addTestResult('Map Initialization', false, error.message);
                console.error('Map initialization error:', error);
            }
        }
        
        function testMarkerCreation(location) {
            try {
                // Try modern AdvancedMarkerElement first
                if (google.maps.marker && google.maps.marker.AdvancedMarkerElement) {
                    marker = new google.maps.marker.AdvancedMarkerElement({
                        position: location,
                        map: map,
                        title: 'Test Location (Advanced Marker)'
                    });
                    addTestResult('Advanced Marker', true, 'AdvancedMarkerElement created successfully');
                } else {
                    // Fallback to traditional Marker
                    marker = new google.maps.Marker({
                        position: location,
                        map: map,
                        title: 'Test Location (Traditional Marker)',
                        icon: {
                            url: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                        }
                    });
                    addTestResult('Traditional Marker', true, 'Traditional Marker created (AdvancedMarkerElement not available)');
                }
            } catch (error) {
                addTestResult('Marker Creation', false, error.message);
                console.error('Marker creation error:', error);
            }
        }
        
        function testGeolocation() {
            if (navigator.geolocation) {
                updateStatus('üåç Testing geolocation...', 'info');
                
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        addTestResult('Geolocation', true, `Location: ${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)}`);
                        
                        if (map) {
                            map.setCenter(userLocation);
                            map.setZoom(15);
                            
                            if (marker) {
                                if (marker.position !== undefined) {
                                    marker.position = userLocation;
                                } else if (marker.setPosition) {
                                    marker.setPosition(userLocation);
                                }
                            }
                        }
                        
                        updateStatus('‚úÖ Geolocation test completed', 'success');
                    },
                    function(error) {
                        let errorMessage = 'Geolocation error: ';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage += 'Permission denied';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage += 'Position unavailable';
                                break;
                            case error.TIMEOUT:
                                errorMessage += 'Request timeout';
                                break;
                            default:
                                errorMessage += 'Unknown error';
                        }
                        
                        addTestResult('Geolocation', false, errorMessage);
                        updateStatus('‚ùå Geolocation test failed', 'error');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                addTestResult('Geolocation', false, 'Geolocation not supported by browser');
                updateStatus('‚ùå Geolocation not supported', 'error');
            }
        }
        
        function testMarker() {
            if (!map) {
                addTestResult('Marker Test', false, 'Map not initialized');
                return;
            }
            
            const testLocation = { lat: -1.286389, lng: 36.817223 };
            
            try {
                if (marker) {
                    // Test marker position update
                    if (marker.position !== undefined) {
                        marker.position = testLocation;
                        addTestResult('Marker Update', true, 'AdvancedMarkerElement position updated');
                    } else if (marker.setPosition) {
                        marker.setPosition(testLocation);
                        addTestResult('Marker Update', true, 'Traditional Marker position updated');
                    }
                    
                    map.setCenter(testLocation);
                    map.setZoom(15);
                } else {
                    testMarkerCreation(testLocation);
                }
            } catch (error) {
                addTestResult('Marker Test', false, error.message);
            }
        }
        
        // Start the test
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadGoogleMaps);
        } else {
            loadGoogleMaps();
        }
    </script>
</body>
</html>